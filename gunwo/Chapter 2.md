# Chapter 2

## 2.1 데이터와 표본분포

---

### 용어 정리

- 표본
    - 더 큰 데이터 집합으로부터 얻은 부분집합
- 모집단
    - 어떤 데이터 집합을 구성하는 전체 대상 혹은 전체 집합
- N(n)
    - 모집단(표본)의 크기
- 임의표본추출
    - 무작위로 표본을 추출하는 것
- 층화표본추출
    - 모집단을 층으로 나눈 뒤, 각 층에서 무작위로 표본을 추출하는 것
- 계층
    - 공통된 특징을 가진 모집단의 동종 하위 그룹
- 단순임의표본
    - 모집단 층화 없이 임의표본추출로 얻은 표본
- 편향
    - 계통상의 오류
- 표본편향
    - 모집단을 잘못 대표하는 표본

---

- 비임의
    - 아무리 랜덤 표본이라고 해도, 어떤 표본도 모집단을 정확하게 대표할 수 없다
- 모집단과 표본 사이의 차이기 유의미할 만큼 크고, 첫 번째 표본과 동일한 방식으로 추출된 다른 샘플들에서도 이 차이가 계속될 것으로 예상될 때 표본편향이 발생했다고 볼 수 있다.
- 임의 표본 추출로 인한 오류와 편향에 따른 오류는 신중하게 구분해서 봐야 한다.
- 임의표본추출을 잘하기 위해서는 접근 가능한 모집단을 적절하게 정의하는 게 매우 중요하다.

## 2.2 선택 편향

---

- 선택 편향
    - 데이터를 의식적이든 무의식적이든 선택적으로 고르는 관행을 의미한다

### 용어 정리

- 선택 편향
    - 관측 데이터를 선택하는 방식 때문에 생기는 편향
- 데이터 스누핑
    - 뭔가 흥미로운 것을 찾아 광범위하게 데이터를 살피는 것
- 방대한 검색 효과
    - 중복 데이터 모델링이나 너무 많은 예측 변수를 고려하는 모델링에서 비롯되는 편향 혹은 비재현성

---

## 2.3 통계학에서의 표본분포

---

- 표본 통계량
    - 더 큰 모집단에서 추출된 표본 데이터들로부터 얻은 측정 지표
- 데이터 분포
    - 어떤 데이터 집합에서의 각 개별 값의 도수분포
- 표본분포
    - 여러 표본들 혹은 재표본들로부터 얻은 표본통계량의 도수분포
- 중심극한정리
    - 표본크기가 커질수록 표본분포가 정규분포를 따르는 경향
- 표준오차
    - 여러 표분들로부터 얻은 표본 통계량의 변량
    - 개별 데이터 값들의 변량을 뜻하는 표준편차와 혼동하지 말 것

---

1. 주요 관심사는 표본의 변동성이다
2. 우리가 많은 양의 데이터를 가지고 있다면 추가의 표본을 얻어서 통계의 분포를 직접 관찰할 수 있다.
3. 평균과 같은 표본 통계량의 분포는 데이터 자체의 분포보다 규칙적이고 종 모양일 가능성이 높다.

```python
sample_data = pd.DataFrame({
    'income' : loans_income.sample(1000),
    'type' : 'Data',
})

sample_mean_05 = pd.DataFrame({
    'income' : [loans_income.sample(5).mean() for _ in range(1000)],
    'type' : 'Mean of 5',
})

sample_mean_20 = pd.DataFrame({
    'income' : [loans_income.sample(20).mean() for _ in range(1000)],
    'type' : 'Mean of 20',
})
```

- 이 코드를 보면 맨 위 코드는 loans_income에서 1000개를 sampling 한 것이고, 두번째는 5개를 sample로 뽑아서 평균을 구한 값을 1000개를 뽑는 것이고, 세번째는 20개를 sample로 뽑아서 평균을 구한 값을 1000개를 뽑고 있다.

<img src='../gunwo/Chapter 2/Untitled.png'>

### 2.3.1 중심극한정리

- 이에 대한 표를 그려보았더니 이처럼 n의 개수가 커질수록 정규화가 되는 것 같이 표가 분포되는 것을 볼 수 있었다.
- 이러한 현상을 **중심극한정리**이라고 한다.
    - 모집단이 정규분포가 아니더라고, 표본 크기가 충분하고 데이터가 정규성을 크게 이탈하지 않는다면, 여러 표본에서 추출한 평균은 종모양의 정규곡선을 따른다.
- 이러한 중심극한정리 덕분에, 추론을 위한 표본분포에, 즉 신뢰구간이나 가설검정을 계산하는 데에 t 분포 같은 정규근사 공식을 사용할 수 있다.
- 하지만 데이터 과학의 관점에서는 대부분의 경우 부트스트랩을 사용할 수 있기 때문에 그렇게 중요하지는 않다.

### 2.3.2 표준오차

- 표준오차
    - 통계의 대한 표본분포의 변동성을 한마디로 말해주는 단일 측정 지표
    
    $$
    표준오차 = SE = s/\sqrt{n}
    $$
    
    - 위 공식처럼 표본 크기가 커지면 표준오차가 줄어든다.
- 표준오차를 측정할 때 고려사항
    1. 모집단에서 완전히 새로운 샘플들을 많이 수집한다.
    2. 각각의 새 샘플에 대해 통계량을 계산한다.
    3. 2단계에서 얻은 통계량의 표준편차를 계산한다. 이것은 표준오차의 추정치로 사용한다.
- 현대 통계에서 부트스트랩은 표준오차를 추정하는 표준 방법잉 되었다.

## 2.4 부트스트랩

- 현재 있는 표본에서 추가적으로 표본을 복원추출하고 각 표본에 대한 통계량과 모델을 다시 계산하는 방법
    - 원래 표본을 수천,수백만번 복제하고 이를 통해 원래 표본으로부터 얻어지는 모든 정보를 포함하는 가상 모집단을 얻는다.
    - 이후 이 모집단으로부터 표본분포를 추정할 목적으로 표본을 수집할 수 있다
- 그러나 표본을 실제로 엄청나게 복제하는 것은 아니다 → **복원추출**

**부트스트랩 알고리즘**

---

1. 샘플 값을 하나 뽑아서 기록하고 다시 제자리에 놓는다.
2. n번 반복
3. 재표본추출된 값의 평균을 기록한다.
4. 1~3단계 R번 반복
5. R개의 결과를 사용하여
    1. 표준편차를 계산한다
    2. 히스토그램 또는 상자그림을 그린다
    3. 신뢰구간을 찾는다

---

- 부트스트랩 반복 횟수는 임의로 설정 - 횟수가 많을수록 표준오차나 신뢰구간 추정이 정확
- 부트스트랩을 구현한 python code

```python
## The Bootstrap

results = []
for nrepeat in range(1000):
    sample = resample(loans_income)
    results.append(sample.median())
results = pd.Series(results)
print('Bootstrap Statistics:')
print(f'original: {loans_income.median()}')
print(f'bias: {results.mean() - loans_income.median()}')
print(f'std. error: {results.std()}')
```

- 부트스트랩은 다변량 데이터에도 적용가능하다.
- 의사결정나무를 사용할 때, 부트스트랩 샘플을 가지고 여러개의 트리르 만든 다음 예측값의 평균을 구하는 게 단일 트리의 예측값을 구하는 것보다 정확하다. - 이러한 과정을 배깅이라고 한다.

### 2.4.1 재표본추출 대 부트스트래핑

- 보통 재표본추출은 여러 표본이 결합되어 비복원추출을 수행할 수 있는 순열 과정을 포함한다.
- 부트스트랩은 항상 관측된 데이터로부터 복원추출한다는 것을 의미한다.

**주요개녕**

---

부트스트랩은 표본통계량의 변동성을 평가하는 강력한 도구

부트스트랩은 다양한 환경에서 유사한 방식으로 적용될 수 있다.

수학적 근사가 어려운 통계량에서도 샘플링 분포를 추정 가능

배깅이 단일 모델 사용보다 좋다.

---

## 2.5 신뢰구간

- 90% 신뢰구간이란, 표본통계량의 부트스트랩 표본분포의 90%를 포함하는 구간을 말한다.
- 일반적으로 표본추정치 주위의 x% 신뢰구간이란, 평균적으로 유사한 표본추정치 x% 정도가 포함되어야 한다.

**부트스트랩 신뢰구간 구하는 법**

---

1. 데이터에서 복원추출 방식으로 크기 n인 표본을 뽑는다(재표본추출)
2. 재표본추출한 표본에 대해 원하는 통계량을 기록한다.
3. 1~2단계를 R번 반복한다.
4. x%의 신뢰구간을 구하기 위해, R개의 재표본 결과의 분포 양쪽 끝에서 [(100-x)/2]%만큼 잘라낸다.
5. 절단한 점들은 x% 부트스트랩 신뢰구간의 양 끝점이다.

---

- 신뢰구간과 관련된 백분율을 신뢰수준이라고 부른다.
    - 신뢰수준이 높을수록 구간이 더 넓어진다.
    - 표본이 작을수록 구간이 넓어진다.

## 2.6 정규분포

- 정규분포는 연속형 확률분포의 하나로, 종 모양의 분포를 가진다.
- 평균과 분산 두 개의 매개변수로 정의된다.
- 평균 $\mu$와 표준편차 $\sigma$를 갖는 정규분포를 $N(\mu, \sigma)$로 나타낸다.
- 표준정규분포는 $\mu=0$, $\sigma=1$인 정규분포를 말한다.
- 정규분포는 중심극한정리와 밀접한 관련이 있다.
- z-score(표준점수)는 개별 값이 평균으로부터 몇 개의 표준편차만큼 떨어져 있는지를 나타내는 척도이다.
- 표준정규분포상에서, 68%는 평균의 표준편차 내에 있다. 95%는 평균의 표준편차 2배수 내에 있다. 99.7%는 평균 표준편차 3배수 내에 있다.

### 2.6.1 표준정규분포와 QQ그림

- 표준정규분포
    - X축의 단위가 평균의 표준편차로 표현되는 정규분포
        - 데이터를 표준 정규분포와 비교하려면 데이터에서 평균을 뺀 다음 표준편차로 나누면 된다.
            - 이를 정규화 라고 한다
            - 이렇게 변환된 값을 Z-SCORE라고 한다
            - 정규분포는 Z분포라고도 한다.
- QQ그림
    - 표본이 특정 분포에 얼마나 가까운지를 시각적으로 판별하는 데 사용된다.
    - Z스코어를 오름차순 정렬하고 그래프를 그린다.
    - 점들이 대각선에 놓이면 정규분포에 가까운 것이다.

## 2.7 긴 꼬리 분포

- 데이터는 일반적으로 정규분포를 따르지 않는다.
- 정규분포가 일반적으로 원시 데이터 분포의 특징을 나타내지는 않는다.
- 대칭 및 비대칭 분포 모두 긴 꼬리를 가질 수 있다.

## 2.8 스튜던트의 t분포

- t분포는 정규분포와 생김새가 비슷하지만, 꼬리부분이 약간 더 두껍고 길다.
- t분포는 표본통계량의 분포를 설명하는 데 광법위하게 사용된다.
- 표준화된 여러 통계자료를 t 분포와 비교하여 신뢰구간을 측정할 수 있다.
- 표본평균, 두 표본평균 간의 차이, 회귀 파라미터, 그 외 다른 통계량들의 분포를 구할 때 t 분포를 사용한다.

## 2.9 이항분포

- 이항식의 결론은 의사 결정 과정에서 아주 중요하기 때문에 분석에서 핵심이다.
- 이항분포랑 각 시행마다 그 성공 확률이 정해져 있을 때, 주어진 시행 횟수 중에서 성공한 회수의 도수분포를 의미한다.
- 이항분포의 평균은 n * p 이다.
- 분산은 n * p(1-p) 이다.
- 이항분포는 사실상 정규분포와 구별이 어렵다.
- 대부분의 통계절차에서는 평균과 분산으로 근사화한 정규분포를 사용한다.

## 2.10 카이제곱분포

- 기댓값
    - 데이터에서 특이하거나 주목할 만한 것이 없다
    - 변수 혹은 예측 가능한 패턴 사이에 상관관계가 없음
- 카이제곱통계량은 검정 결과가 독립성에 대한 귀무 기댓값에서 벗어난 정도를 측정하는 통계량
- 카이제곱통계량은 관측 데이터가 특정 분포에 적합한 정도를 나타낸다(적합도검정)

## 2.11 F 분포

- F 분포는 테스트 통계량의 귀무 가설 분포로 자주 나타난다.
- 분자와 분모의 자유도, 두 가지 매개변수를 가지며, 분산 분석(ANOVA) 및 회귀 분석에서 사용됩니다.
- 분산 분석
    - 각 그룹 내 변동성에 대한 그룹 평균 간 변동성의 비율
- F 통계량의 분포는 모든 그룹의 평균이 동일한 경우 무작위 순열 데이터에 의해 생성되는 모든 값의 빈도 분포이다.
- 서로 다른 자유도에 따라 다양한 F분포가 있다.

## 2.12 푸아송 분포와 그 외 관련 분포들

### 2.12.1 푸아송 분포

- 푸아송 분포
    - 시간 단위 또는 공간 단위로 표본들을 수집할 때, 그 사건들의 분포를 알려준다
- 푸아송 분포의 핵심 파라미터는 람다이다. 람다는 어떤 일정 시간/공간의 구간 안에서 발생한 평균 사건 수를 의미한다. 푸아송 분포의 분산 역시 람다 이다.

### 2.12.2 지수분포

- 지수분포
    - 사건간의 시간 간격이 따르는 분포
    - 특정 사건이 일어날 때까지 걸리는 시간이 따르는 분포
    - 람다는 단위 시간당 평균 사건 수를 의미한다.
    - 평균과 분산이 모두 1/λ 이다.
    - 지수분포는 기하분포와 밀접한 관련이 있다.
- 푸아송이나 지수분포에 대한 시뮬레이션 연구에서 핵심은 람다가 해당 기간동안 일정하게 유지된다는 가정이다
    - 시간 주기 또는 공간을 일정기간동안 충분히 동일하도록 영역을 잘 나눈다면 해당 기간 내의 분석 및 시뮬레이션이 가능하다.

### 2.12.3 고장률 추정

- 시뮬레이션 또는 확률의 직접 계산을 통해 다른 가상 사건 발생률을 평가하고, 그 이하로 떨어지지 않을 임곗값을 추산할 수 있다.
- 데이터가 있긴 하지만 정확하고 신뢰할 만한 발생률을 추정하기에 충분하지 않은 경우, 적합도검정을 통해 적용한 여러 발생률 중 어떤 것이 관찰된 데이터에 적합한지를 알 수 있다.

### 2.12.4 베이불 분포

- 많은 경우에 사건 발생율은 시간에 따라 일정하지 않다.
- 베이불 분포는 지수분포를 확장한 것으로, 형상 파라미터로 지정된 대로 발생률이 달라질 수 있다.
- 파라미터>1 이면 발생률은 시간이 지남에 따라 증가하고, 파라미터<1이면 시간에 따라 감소한다.
- 베이불을 사용할 때는 두 변수 B와 N의 추정이 포함된다. 가장 적합한 베이불 분포를 추정하고 데이터를 모델링하는 데에는 소프트웨어를 사용한다.

## 2.13 마치며…

- 정확한 추정이 요구되는 경우, 임의표본추출의 원칙을 지키는 것이 매우 중요하다.
    - 데이터를 무작위로 사용하는 것보다 편향을 줄이고 질적으로 더 좋은 데이터를 얻을 수 있다.
- 부트스트랩은 표본추정에서 잠재적 오차를 판별할 때 유용한 ‘**모든 문제에 적용 가능한**’ 방법이다.